<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Wynn&#39;s tech blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Wynn&#39;s tech blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wynn&#39;s tech blog">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Wynn's tech blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wynn's tech blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/08/为什么要用-SWC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wynn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wynn's tech blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/08/为什么要用-SWC/" itemprop="url">
                  为什么要用 SWC
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-07-08 17:45:00 / Modified: 17:54:27" itemprop="dateCreated datePublished" datetime="2021-07-08T17:45:00+08:00">2021-07-08</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在这全员内卷的年代，打包工具也开始内卷！！！Vite，Snawpack等新型构建工具的出现，严重影响了传统工具的地位。But！并不是完全地没希望了！以下介绍一个有望替代Babel的成长型构建工具SWC；</p>
<h2 id="什么是Babel？"><a href="#什么是Babel？" class="headerlink" title="什么是Babel？"></a>什么是Babel？</h2><p>Babel 是一个工具，可以将较新版本的 JavaScript 代码（例如ES6）转译为旧版本的 JavaScript——它甚至可以转译TypeScript。</p>
<p>Babel 根据您为它定义的配置读取源代码并编译更新的 JavaScript 功能，例如箭头函数或optional-chain等。Babel的编译原理大致如下：</p>
<ul>
<li><p>首先，Babel 的解析器获取 JavaScript 代码并将其转换为抽象语法树 (AST)</p>
</li>
<li><p>接下来，Babel 的遍历器获取 AST，按一定的定式将其修改为我们在 Babel 配置中定义的预期代码</p>
</li>
<li><p>最后，Babel 的生成器会将修改后的 AST 转换回常规代码</p>
</li>
</ul>
<p><img src="../imgs/ast.png" alt="抽象语法树 "></p>
<h2 id="Babel-的替代方案（用-Rust-编写）"><a href="#Babel-的替代方案（用-Rust-编写）" class="headerlink" title="Babel 的替代方案（用 Rust 编写）"></a>Babel 的替代方案（用 Rust 编写）</h2><p>SWC(<a href="https://swc-project.github.io/)也是" target="_blank" rel="noopener">https://swc-project.github.io/)也是</a> JavaScript 中的 transpiler ，它是用 Rust 编写的，是比 Babel 快得多。Rust 以其性能和可靠性而闻名，Rust 如此高效的原因之一是垃圾回收，通过不再使用的数据对象释放内存资源。由于 Rust 在编译时决定不再需要哪些内存资源并且不必连续运行，因此处理时间减少而性能提升增加。</p>
<h2 id="不是所有的前端项目都需要编译器！"><a href="#不是所有的前端项目都需要编译器！" class="headerlink" title="不是所有的前端项目都需要编译器！"></a>不是所有的前端项目都需要编译器！</h2><p>在某些情况下，可能不需要使用编译器：</p>
<ul>
<li>如果您正在构建一个主要依赖于受良好支持的 JavaScript 版本（如ES3 ）的简单项目。例如，代码几乎可以在所有浏览器上运行。</li>
</ul>
<ul>
<li>如果您正在构建一个依赖于较新版本的 JavaScript（如箭头函数）的简单项目，但您需要支持的浏览器也确实支持这些新功能。例如，某个后台项目限定使用的浏览器</li>
</ul>
<p>浏览器使用不同类型的 JavaScript 引擎，如V8 (Chrome)、SpiderMonkey (Firefox) 和Chakra (IE)。某些API的表现在不同的引擎里是不一致的。这就是为什么我们需要在许多不同的浏览器中一致地处理我们的 JavaScript 代码。</p>
<h2 id="SWC的使用"><a href="#SWC的使用" class="headerlink" title="SWC的使用"></a>SWC的使用</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// install swc core as well as its cli tool</span><br><span class="line">npm install --save-dev @swc/core @swc/cli</span><br></pre></td></tr></table></figure>
<p><code>@swc/core</code>将帮助我们进行构建项目，而 <code>@swc/cli</code>  可以在终端中使用命令运行。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在项目的根目录创建一个 <code>.swcrc</code> 文件，配置信息如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">      <span class="attr">"targets"</span>: &#123;</span><br><span class="line">        <span class="attr">"chrome"</span>: <span class="string">"58"</span>,</span><br><span class="line">        <span class="attr">"ie"</span>: <span class="string">"11"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>或者也可以这样配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">      <span class="attr">"targets"</span>: <span class="string">"&gt; 0.25%, not dead"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  getExp.js</span></span><br><span class="line"><span class="keyword">const</span> getExp = <span class="keyword">async</span> key =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> mapCookie = <span class="string">'experiment_map'</span></span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">await</span> cookie.get(mapCookie)</span><br><span class="line">    <span class="keyword">if</span> (!map) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> mapParsed = &#123;&#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mapParsed = <span class="built_in">JSON</span>.parse(map) || &#123;&#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(err)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mapParsed.xname === key) &#123;</span><br><span class="line">            <span class="keyword">return</span> mapParsed.xvar || <span class="number">0</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以运行以下命令对该文件进行转译：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 转换 getExp.js，转换完成后代码会直接在终端输出。</span><br><span class="line">npx swc getExp.js</span><br><span class="line">// 转换 getExp.js ，转换完成后输出到 dist 目录。</span><br><span class="line">npx swc getExp.js -o dist/index.js</span><br><span class="line"></span><br><span class="line">// 转换 src 目录中的所有 JS 文件，转换后的文件会输出到 dist 目录。</span><br><span class="line">npx swc src -d dist</span><br></pre></td></tr></table></figure>
<p>想要查看转译后的文件是什么样的，可以使用这个SWC playground(<a href="https://swc-playground.now.sh/)预览下。" target="_blank" rel="noopener">https://swc-playground.now.sh/)预览下。</a></p>
<p>如果需要转换模块，需要在 <code>.swcrc</code> 目录中添加模块配置，如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">".*.js$"</span>,</span><br><span class="line">    <span class="attr">"module"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"amd"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">      <span class="attr">"targets"</span>: <span class="string">"&gt; 0.25%, not dead"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>上面配置把 <code>js</code> 文件转换为 AMD 模块。</p>
<p>下面是一个 ES6 模块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> a = <span class="string">'hello'</span></span><br><span class="line">    <span class="keyword">const</span> b = <span class="string">'world'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;a&#125;</span> <span class="subst">$&#123;b&#125;</span>!`</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>转换后如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">define([</span><br><span class="line">    <span class="string">"exports"</span></span><br><span class="line">], <span class="function"><span class="keyword">function</span>(<span class="params">_exports</span>) </span>&#123;</span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(_exports, <span class="string">"__esModule"</span>, &#123;</span><br><span class="line">        value: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    _exports.default = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> _default = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="string">'hello'</span>;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="string">'world'</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>.concat(a, <span class="string">" "</span>).concat(b, <span class="string">"!"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    _exports.default = _default;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意！SWC 只能转换 ES6 的语法部分，对于 <code>Promise</code> 之类的功能是无法转换的。</em></p>
<h3 id="Webpack-swc-loader"><a href="#Webpack-swc-loader" class="headerlink" title="Webpack-[swc-loader]"></a>Webpack-[swc-loader]</h3><p>安装 <code>@swc/core</code> 和 <code>swc-loader</code> ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save-dev @swc/core swc-loader</span><br></pre></td></tr></table></figure>
<p>Webpack 的配置如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// global dependencies</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">"development"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">    filename: <span class="string">'index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">        &#123;</span><br><span class="line">        test: <span class="regexp">/\.jsx?$/</span> ,</span><br><span class="line">        exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">            <span class="comment">// `.swcrc` in the root can be used to configure swc</span></span><br><span class="line">            loader: <span class="string">"swc-loader"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"html-loader"</span>,</span><br><span class="line">            options: &#123; <span class="attr">minimize</span>: <span class="literal">true</span> &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.scss/i</span>,</span><br><span class="line">        use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>, <span class="string">"sass-loader"</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>swc 的配置 和 Babel 的配置类似 可以通过外部的 <code>.swcrc</code> 来配置对应的信息</p>
<p>整体的代码编译解析过程都是一致的，唯一需要注意的点就是 上面提到过的类似 Promise的功能，是需要额外引入的；另外，有些已经在 Babel  上使用的 transform，目前还未实现，具体可以查看 <a href="https://swc.rs/docs/comparison-babel/" target="_blank" rel="noopener">https://swc.rs/docs/comparison-babel/</a></p>
<h3 id="React-swc-loader"><a href="#React-swc-loader" class="headerlink" title="React-[swc-loader]"></a>React-[swc-loader]</h3><p>在  <code>React</code> 里在使用 <code>SWC</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// App.jsx</span><br><span class="line">// global dependencies</span><br><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import ReactDOM from &apos;react-dom&apos;;</span><br><span class="line"></span><br><span class="line">const App = () =&gt; &#123;</span><br><span class="line">  return &lt;h1&gt;My SWC App&lt;/h1&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;App /&gt;, document.querySelector(&quot;#root&quot;));</span><br></pre></td></tr></table></figure>
<p>修改 <code>.swcrc</code> 配置，然后新增配置如下，react代码</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// .swcrc</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"jsc"</span>: &#123;</span><br><span class="line">      <span class="attr">"parser"</span>: &#123;</span><br><span class="line">        <span class="attr">"syntax"</span>: <span class="string">"ecmascript"</span>,</span><br><span class="line">        <span class="attr">"jsx"</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">".*.js"</span>,</span><br><span class="line">    <span class="attr">"module"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"amd"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"env"</span>: &#123;</span><br><span class="line">      <span class="attr">"targets"</span>: <span class="string">"&gt; 0.25%, not dead"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>通过以上的配置文件，做各种配置的转化，我们能处理很多目前写出来的代码</p>
<h2 id="Babel-和-SWC-的速度比较"><a href="#Babel-和-SWC-的速度比较" class="headerlink" title="Babel 和 SWC 的速度比较"></a>Babel 和 SWC 的速度比较</h2><p>编译器的速度至关重要，对于开发人员来说，可以在这方面节省的任何时间都是宝贵的。以下是由 SWC 项目的维护者执行的测试</p>
<h3 id="单核-CPU"><a href="#单核-CPU" class="headerlink" title="单核 CPU"></a>单核 CPU</h3><p><img src="../imgs/swc-test1.png" alt="image-20210630165907795"></p>
<h3 id="多核CPU"><a href="#多核CPU" class="headerlink" title="多核CPU"></a>多核CPU</h3><p>为了利用到多核，测试用 多开 promise 来测试运行的性能</p>
<p>同时运行4个promise</p>
<p><img src="../imgs/swc-test2.png" alt="image-20210630170650346"></p>
<p>同时运行100个promise</p>
<p><img src="../imgs/swc-test3.png" alt="image-20210630170708004"></p>
<p>在多核异步情况下，SWC能充分利用CPU的性能，比在单核里的较量提升得更明显。</p>
<p>总的来说，两个工具之间存在明显的速度差距，因为 SWC在单线程和 CPU 内核基础上往往比 Babel 快 <strong>20</strong> 倍左右，而在多核异步操作过程中则快 <strong>60</strong> 倍左右。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>上面讲到编译器的基础知识，在一定的情况下比较了双方的能力：</p>
<ul>
<li>他们的构建工作流程类似，易上手</li>
<li>【优】SWC 与 Babel 相比具有显着的速度优势</li>
<li>【劣】SWC 在总体的适配上还有很多不足，很多新东西还未适配</li>
</ul>
<p>尽管如此，SWC 还是有希望能在传统的构建流程上 让 性能速度 这一项数据 不再成为我们的累赘。</p>
<p>PS：工具不断内卷的原因 还是因为代码世界不够完美；人嘛！够完美了！就不要内卷了嘛！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/08/ESN-构建工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wynn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wynn's tech blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/08/ESN-构建工具/" itemprop="url">
                  ESN 构建工具
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-07-08 17:42:42 / Modified: 18:15:31" itemprop="dateCreated datePublished" datetime="2021-07-08T17:42:42+08:00">2021-07-08</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前段时间周会上提到了 vite 构建工具的 搭建的事情，出于对其好奇，遂开始进入探索模式。</p>
<p>vite是基于ESM的构建工具，除此之外还有snowpack（前期对其关注始于 piko/web项目，现更名完差点不认识了 :joy:）等。 ESM 的意义是 让项目的工程构建不再需要构建一个完整的 bundle，借助浏览器 ESM 的能力，一些代码基本可以做到无需构建直接运行。</p>
<p>ESM的构建工具 和 传统 bundle 构建工具之间，最直观的体感就是 编译的速度，直接给前端工程师看到了996变955的希望。（狗头脸）</p>
<p>当然，传统构建工具秉持着 被骂习惯了，偶尔也要动一动的精神，也在不断努力提升自己性能（你过来啊！！！）。</p>
<p>正面刚不过，传统依然有自己的优势存在。</p>
<h1 id="打包的由来"><a href="#打包的由来" class="headerlink" title="打包的由来"></a>打包的由来</h1><p>最开始的打包可以从把多个 JavaScript 文件 输出成一个文件，减少网络请求开始讲起，这更像是合并代码，但是也是打包的一个过程。</p>
<p>后续，JavaScript 的打包的正式概念是 JavaScript 的模块化开始。在尝到模块化的甜头之后，模块化的整个开发被生态化，随之而来的是怎么合理组合模块，怎么让浏览器正确运行前端项目，打包工具由此应运而生。</p>
<p>在前端工程不断地发展下，打包构建工具的地位愈发重要，对工具本身的要求也愈高。</p>
<h1 id="snowpack"><a href="#snowpack" class="headerlink" title="snowpack"></a>snowpack</h1><p>为什么基于 ESM的构建工具 snowpack/vite 会比 webpack 在构建的时候要快很多，以下是对 snowpack的简介</p>
<blockquote>
<p>Snowpack is a lightning-fast frontend build tool, designed for the modern web. It is an alternative to heavier, more complex bundlers like webpack or Parcel in your development workflow. Snowpack leverages JavaScript’s native module system (known as ESM) to avoid unnecessary work and stay fast no matter how big your project grows.</p>
</blockquote>
<p>简单解释下重点：</p>
<blockquote>
<p>能在开发流程内替代原有的繁重且复杂的构建工具。借助 ESM 的能力，不管你的项目有多大，模块化交给浏览器处理，避免了打包过程中的不必要的工作，不存在资源重复加载的问题，如果不是涉及到 jsx 或者 typescript 语法，甚至 <strong>可以不用编译直接运行</strong></p>
</blockquote>
<h2 id="snowpack-的-ESM-使用"><a href="#snowpack-的-ESM-使用" class="headerlink" title="snowpack 的 ESM 使用"></a>snowpack 的 ESM 使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"/index.js"</span> type=<span class="string">"module"</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>通过 type=”module” 告诉浏览器，当前脚本使用 ESM 模式，浏览器会构建一个依赖关系，借助浏览器原生的 ESM 能力完成模块的找、解析、实例化到执行的过程。</p>
<p>index.js 里 可以是最直接的文件之间的import引用。</p>
<h2 id="构建流程"><a href="#构建流程" class="headerlink" title="构建流程"></a>构建流程</h2><p>前端的复杂度在于 需要处理各种不同的资源文件，包括但不限于HTML, JS, CSS, 图片，语音文件等等资源。在整个项目流程中，需要处理这些资源，让浏览器能正确地识别并执行。</p>
<p>snowpack 就对 以上资源 的构建做了不同的处理方式。</p>
<h3 id="Import-依赖"><a href="#Import-依赖" class="headerlink" title="Import 依赖"></a>Import 依赖</h3><h4 id="第三方依赖"><a href="#第三方依赖" class="headerlink" title="第三方依赖"></a>第三方依赖</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转化为</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"./_snowpack/pkg/react.v17.0.2.js"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"./_snowpack/pkg/react-dom.v17.0.2.js"</span>;</span><br></pre></td></tr></table></figure>
<p>利用自己的  <strong><em>/_snowpack/pkg/</em></strong> 前缀，来匹配到 node_modules 下对应的第三方依赖，并输出。</p>
<p> 重点看 剪头，对于第三方自己的依赖  也是已这样的形式输入，也就是完全摆脱了webpack 需要构建 具大的</p>
<p><img src="../imgs/1b5abd5943e2444e97ea5a5c6dfa0ac8_image.png" alt="1b5abd5943e2444e97ea5a5c6dfa0ac8_image.png"> </p>
<h4 id="项目内代码依赖"><a href="#项目内代码依赖" class="headerlink" title="项目内代码依赖"></a>项目内代码依赖</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  B  <span class="keyword">from</span>  <span class="string">'./B'</span></span><br><span class="line"><span class="comment">// 转化为</span></span><br><span class="line"><span class="keyword">import</span> B <span class="keyword">from</span> <span class="string">"./B.js"</span>;</span><br></pre></td></tr></table></figure>
<p><img src="../imgs/4c3106d93ea146f1ba16eb42ec76c022_image.png" alt="4c3106d93ea146f1ba16eb42ec76c022_image.png"> </p>
<p>对于自有的文件依赖，很简单地直接用相对根目录的路径来确认匹配到正确的文件。</p>
<p>这里我们可以有个思考，上述两者，为什么需要做这样的区分。个人想法是，出于对目前的第三方依赖并不是完全的ESM导出，需要启动一个转换的接口，来兼容这些不确定因素。</p>
<h3 id="Import-图片"><a href="#Import-图片" class="headerlink" title="Import 图片"></a>Import 图片</h3><p>对于图片的引用，我们是倾向于直接利用路径，直接输出对应静态资源的URL，在 snowpack 里</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  shoes  <span class="keyword">from</span>  <span class="string">'./shose.png'</span></span><br><span class="line"><span class="comment">// 转化为</span></span><br><span class="line"><span class="keyword">import</span> shoes <span class="keyword">from</span> <span class="string">"./shose.png.proxy.js"</span>;</span><br></pre></td></tr></table></figure>
<p>对图片的处理是转化成一个JS文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./shose.png.proxy.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">"/shose.png"</span>;</span><br></pre></td></tr></table></figure>
<p>JS文件内 输出 对应的资源的 相对路径，把对应的图片资源或拷贝或直连到本地目录</p>
<p><img src="../imgs/853cc290e6b543e8963508c93a655b3d_image.png" alt="853cc290e6b543e8963508c93a655b3d_image.png"> </p>
<p>这样的处理方式的确更方便图片的引用，但是带来的问题是 如果是一个页面中引用了相当多的图片的时候，每一张图片都可能产出两个对应的文件来确保引用的正确性，整体的请求量是double的</p>
<h3 id="Import-css"><a href="#Import-css" class="headerlink" title="Import css"></a>Import css</h3><p>CSS的引用方式就很hack，创建了对应的css.proxy.js，把css的内容字符串化，通过在页面上创建style link的形式，把css引用到页面里</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"./App.css"</span>;</span><br><span class="line"><span class="comment">// 转化为</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./App.css.proxy.js"</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./App.css.proxy.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span>  __SNOWPACK_HMR__ <span class="keyword">from</span> <span class="string">'/_snowpack/hmr-client.js'</span>;</span><br><span class="line"><span class="keyword">import</span>.meta.hot = __SNOWPACK_HMR__.createHotContext(<span class="keyword">import</span>.meta.url);</span><br><span class="line"></span><br><span class="line"><span class="comment">// [snowpack] add styles to the page (skip if no document exists)</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">document</span> !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">  <span class="keyword">import</span>.meta.hot.accept();</span><br><span class="line">  <span class="keyword">import</span>.meta.hot.dispose(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.head.removeChild(styleEl);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> code = <span class="string">".App &#123;\n    color: red;\n&#125;"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> styleEl = <span class="built_in">document</span>.createElement(<span class="string">"style"</span>);</span><br><span class="line">  <span class="keyword">const</span> codeEl = <span class="built_in">document</span>.createTextNode(code);</span><br><span class="line">  styleEl.type = <span class="string">'text/css'</span>;</span><br><span class="line">  styleEl.appendChild(codeEl);</span><br><span class="line">  <span class="built_in">document</span>.head.appendChild(styleEl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h3><p>对应其他的一些文件 其实大差不差 的处理方式，通过创建 JS 文件，产出 ESM 模式的文件，然后利用浏览器native的能力来解析处理 应用内的 依赖</p>
<h1 id="snowpack-VS-webpack"><a href="#snowpack-VS-webpack" class="headerlink" title="snowpack VS webpack"></a>snowpack VS webpack</h1><ol>
<li>整个生态环境 对于 目前 的 ESM 构建工具 还是弱的，整体的支持需要不断地去兼容。老牌大佬Webpack 在前端生态圈混迹多年 已经涵盖能涵盖的所有第三方依赖。</li>
<li>webpack 对自己被不断诟病的 性能问题 也一直在出解决方案 包括 Module Federation 等；缓存等机制也是需要看公司本身是否能匹配，像嘉云目前的前端发布方式 缓存根本没用，这样的优化也就不了了之。</li>
</ol>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>目前来看，ESM 是一个大的趋势，但是基于大环境的考虑，生产包 还是 要依赖 webpack 等来兼容 可能不支持 ESM 模式的浏览器，那 生产环境 和 开发环境 并不处于同一个 代码模式下，也会有风险点。</p>
<p> 除此之外，预编译的babel新特性或者 sass 等 浏览器不支持的特性，还是需要依赖打包来构建，这里的性能发挥应该也会成为未来的一个卡点</p>
<p> 未来更多的路，在确保生产和开发的同步之后，应该是webpack 和 ESM，相结合的方式。走过这一段路之后，再看 ESM 的天地有多高吧</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/08/前端图片通识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wynn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wynn's tech blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/08/前端图片通识/" itemprop="url">
                  前端图片通识
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-07-08 14:03:24 / Modified: 18:06:18" itemprop="dateCreated datePublished" datetime="2021-07-08T14:03:24+08:00">2021-07-08</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前端的同学对图片这个媒体素材不陌生，但是对于图片的一些基础的知识了解甚少。下面会针对图片的一些特性，扩展知识。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="矢量图与栅格图像"><a href="#矢量图与栅格图像" class="headerlink" title="矢量图与栅格图像"></a>矢量图与栅格图像</h3><ul>
<li>矢量图：形使用线、点和多边形来表示图像。</li>
<li>栅格图像： 通过对矩形格栅内的每个像素的值进行编码来表示图像。</li>
</ul>
<p>矢量图： 代表图 SVG，矢量图的缩放不会导致图片的失真</p>
<p>栅格图像：代表图 JPG, PNG等。由一个个的像素栅格组成；每个像素都编码了颜色和透明度信息；使用不用的压缩算法，以减小图像的文件大小。</p>
<h3 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h3><ul>
<li>有损压缩：指在压缩文件大小的过程中，损失了一部分图片的信息，也即降低了图片的质量，并且这种损失是不可逆的，我们不可能从有一个有损压缩过的图片中恢复出全来的图片。常见的有损压缩手段，是按照一定的算法将临近的像素点进行合并。</li>
<li>无损压缩：只在压缩文件大小的过程中，图片的质量没有任何损耗。我们任何时候都可以从无损压缩过的图片中恢复出原来的信息。</li>
<li>空间分割优化：通俗话来讲，就是把一张图 色值相差在一个范围内的分成一个区域，再分别对区域冗余性压缩</li>
</ul>
<h2 id="JPG-JPEG-和-PNG"><a href="#JPG-JPEG-和-PNG" class="headerlink" title="JPG/JPEG 和 PNG"></a>JPG/JPEG 和 PNG</h2><p>下面通过比对 两种 不同格式的图片来 GET 图片上的一些特性，对于GIF等动态图会更复杂，暂不展开</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>两种图片对应的图像格式都是 栅格图像</p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>JPG/JPEG:<ol>
<li>不支持透明；</li>
<li>有损压缩。压缩时质量级别越低体积越小，图片也越模糊。所以，在使用时，需要根据需要选择合适的质量级别。</li>
<li>JPEG 适合于色彩丰富，线条感比较弱的图片，比如大的背景图，banner 图等等。</li>
</ol>
</li>
<li>PNG:<ol>
<li>支持透明；</li>
<li>无损压缩；但是可以调整调色板的大小来减小体积。</li>
<li>PNG 是一种无损压缩的高保真的图片格式，可以保存更多的细节，同时体积也就相对大。</li>
</ol>
</li>
</ul>
<h3 id="编码格式和加载方式"><a href="#编码格式和加载方式" class="headerlink" title="编码格式和加载方式"></a>编码格式和加载方式</h3><ul>
<li><p>JPG/JPEG:<br>  对应有jpg baseline 和 jpg progressive 两种比较常见的编码格式。</p>
<p>  jpg baseline 在加载的时候是采用离散余弦变换算法，逐行扫描，也就是从图片的头部开始往下一行一行地扫描并且加载。现在大部分的图片应该都是采用这种方式加载。缺点非常的明显，在网速很差或者图片很大的情况下，给用户的感受就是从白屏一点点往下显示。</p>
<p>  jpg progressive 在加载时候是采用小波算法，交错扫描（隔行扫描）。图像分成多次扫描， 第一次扫描以模糊或低质量设置显示图像，后续扫描逐步提高图像质量。 我们可以将这个过程看作“渐进式”提高图像质量。 每次“扫描”图像都会增加细节的清晰程度，最后合并为全画质图像。jpg progressive 可以在没有下载完图片就可以看到最终图像的大致轮廓甚至感官中的图片本身，一定程度上可以提升用户体验。</p>
<p>  两者相比，jpg progressive需要更多的 CPU 资源去解码。</p>
<p>  <del>使用jpg baseline 相比还是jpg progressive，需要我们根据场景选择，在文件大小，网络延迟和 CPU 消耗之间做一个权衡。</del></p>
<p>  基于现实场景，大多数情况下，我们都不太care用户的CPU资源（上面那句话就是官方一点）</p>
</li>
<li><p>PNG:<br>  PNG的常用三种形式：PNG8，PNG24 和 PNG32。</p>
<p>  他们对应的不同是每个像素点的数据，PNG8 需要 8 位即一个字节，而 PNG24 使用 24 位也就是三个字    节：RGB 三个通道各需一个字节。<br>  因为位数不同，能表示的颜色数量不同。PNG8 最多只能表示 256 色，而 PNG24 支持 24 位真彩色。</p>
<p>  到这里其实对于PNG的为什么无损压缩还能压缩 有了一定的概念，PNG压缩的是像素点对应的数据位数</p>
<p>  话不多述 直接上图，下面是一张皮卡丘的简单图</p>
</li>
</ul>
<h2 id="前端对图片压缩的处理"><a href="#前端对图片压缩的处理" class="headerlink" title="前端对图片压缩的处理"></a>前端对图片压缩的处理</h2><p>其实很惨，前端的javascript 在不基于node的情况下能对图片的控制和处理程度非常有限。因为处理图片需要大量的计算，猜测这也是为什么限制基于浏览器的图片处理。<br>既然是有限 那也是有压缩的办法。直接贴代码：</p>
<p>核心思想是两个</p>
<ol>
<li>基于exif-js库去确认图片的基本信息，对图片进行矫正；</li>
<li>基于 canvas 画出图片，再依赖canvas的api去导出图片原数据</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/04/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wynn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wynn's tech blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/01/04/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2021-01-04 17:56:47" itemprop="dateCreated datePublished" datetime="2021-01-04T17:56:47+08:00">2021-01-04</time>
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Wynn</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wynn</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
